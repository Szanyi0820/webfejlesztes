<div *ngIf="!isLoggedIn" class="login-container">
  <h2>Login</h2>
  <form (submit)="onLogin(); $event.preventDefault()">
    <div>
      <label for="username">Username</label>
      <input
        type="text"
        id="username"
        [(ngModel)]="username"
        name="username"
        required
      />
    </div>
    <div>
      <label for="password">Password</label>
      <input
        type="password"
        id="password"
        [(ngModel)]="password"
        name="password"
        required
      />
    </div>
    <button type="submit">Login</button>
    <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>
  </form>
  <h2>Register</h2>
  <form (submit)="onRegister(); $event.preventDefault()">
    <div>
      <label for="registerUsername">Username</label>
      <input
        type="text"
        id="registerUsername"
        [(ngModel)]="registerUsername"
        name="registerUsername"
        required
      />
    </div>
    <div>
      <label for="registerPassword">Password</label>
      <input
        type="password"
        id="registerPassword"
        [(ngModel)]="registerPassword"
        name="registerPassword"
        required
      />
    </div>
    <div>
      <label for="registerEmail">Email</label>
      <input
        type="email"
        id="registerEmail"
        [(ngModel)]="registerEmail"
        name="registerEmail"
        required
      />
    </div>
    <button type="submit">Register</button>
    <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>
  </form>
</div>
<div *ngIf="isLoggedIn">

<p-dialog header="Add car" [modal]="true" [(visible)]="visible" >

<form #carForm="ngForm" (ngSubmit)="addCar()" novalidate *ngIf="showCars">
  <!-- Brand Name Input with icon -->
  <p-inputGroup>
    <p-inputGroupAddon>
      <i class="pi pi-car"></i>
    </p-inputGroupAddon>
    <input id="brandName" pInputText placeholder="Brand Name" [(ngModel)]="newCar.properties.carType.brandName" name="brandName" required />


    <!-- Color Input with icon -->

    <p-inputGroupAddon>
      <i class="pi pi-palette"></i>
    </p-inputGroupAddon>
    <input id="color" pInputText placeholder="Color" [(ngModel)]="newCar.properties.carType.color" name="color" required />


    <!-- Fuel Type Input with icon -->

    <p-inputGroupAddon>
      <i class="pi pi-gauge"></i>
    </p-inputGroupAddon>
    <input id="fuelType" pInputText placeholder="Fuel Type" [(ngModel)]="newCar.properties.carType.fuelType" name="fuelType" required />


    <!-- Max Speed Input with icon -->

    <p-inputGroupAddon>
      <i class="pi pi-clock"></i>
    </p-inputGroupAddon>
    <input id="maxSpeed" type="number" pInputText placeholder="Max Speed" [(ngModel)]="newCar.properties.carType.maxSpeed" name="maxSpeed" required />


    <!-- Price Input with currency addon -->

    <p-inputGroupAddon>$</p-inputGroupAddon>
    <input id="price" type="number" pInputText placeholder="Price" [(ngModel)]="newCar.properties.carType.price" name="price" required />
    <p-inputGroupAddon>.00</p-inputGroupAddon>


    <!-- Type Name Input -->

    <p-inputGroupAddon>
      <i class="pi pi-id-card"></i>
    </p-inputGroupAddon>
    <input id="typeName" pInputText placeholder="Type Name" [(ngModel)]="newCar.properties.carType.typeName" name="typeName" required />


    <!-- Factory Date Input -->

    <p-inputGroupAddon>
      <i class="pi pi-calendar"></i>
    </p-inputGroupAddon>
    <input id="factoryDate" type="date" pInputText [(ngModel)]="newCar.properties.factoryDate" name="factoryDate" required />


    <!-- Plate Number Input with format hint -->

    <p-inputGroupAddon>
      <i class="pi pi-tag"></i>
    </p-inputGroupAddon>
    <input id="plateNumber" pInputText placeholder="Plate Number (e.g., ABC-123)" [(ngModel)]="newCar.properties.plateNumber" name="plateNumber" required pattern="^[A-Z]{3}-\d{3}$" />


    <!-- Submit Button -->
    <p-button value="Primary" styleClass="ui-button-outlined" type="submit" [disabled]="carForm.invalid">Add Car</p-button>
  </p-inputGroup></form>
</p-dialog>
<p-dialog header="Add owner" [modal]="true" [(visible)]="visible" *ngIf="!showCars">
<form #carForm="ngForm" (ngSubmit)="addOwner()" novalidate >
  <!-- Brand Name Input with icon -->
  <p-inputGroup *ngIf="!showCars">
    <p-inputGroupAddon>
      <i class="pi pi-face-smile"></i>
    </p-inputGroupAddon>
    <input id="name" pInputText placeholder="Name" [(ngModel)]="newOwner.properties.name" name="Name" required />


    <!-- Color Input with icon -->

    <p-inputGroupAddon>
      <i class="pi pi-folder"></i>
    </p-inputGroupAddon>
    <input id="email" pInputText placeholder="Email" [(ngModel)]="newOwner.properties.email" name="email" required />


    <!-- Fuel Type Input with icon -->

    <p-inputGroupAddon>
      <i class="pi pi-phone"></i>
    </p-inputGroupAddon>
    <input id="contactNumber" pInputText placeholder="Contact Number" [(ngModel)]="newOwner.properties.contactNumber" name="contactNumber" required />

    <!-- Plate Number Input with format hint -->

    <p-inputGroupAddon>
      <i class="pi pi-car"></i>
    </p-inputGroupAddon>
    <input id="plateNumberOwner" pInputText placeholder="Plate Number (e.g., ABC-123)" [(ngModel)]="newOwner.properties.plateNumber" name="plateNumber" required pattern="^[A-Z]{3}-\d{3}$" />


    <!-- Submit Button -->
    <p-button value="Primary" styleClass="ui-button-outlined" type="submit" [disabled]="carForm.invalid">Add Owner</p-button>
  </p-inputGroup></form>
</p-dialog>


<div class="layout-container" >
  <!-- Sidebar with filters -->
  <p-sidebar [(visible)]="sidebarVisible" *ngIf="showCars">
    <p-button (onClick)="showDialog()" label="Add Car" *ngIf="isAdmin" />
    <p-button (click)="logout()">Logout</p-button>
    <h3>Filters</h3>

    <div>
      <label for="brandNameFilter">Brand:</label>
      <input id="brandNameFilter" pInputText [(ngModel)]="brandNameFilter" placeholder="Filter by brand" />
    </div>

    <div>
      <label for="colorFilter">Color:</label>
      <input id="colorFilter" pInputText [(ngModel)]="colorFilter" placeholder="Filter by color" />
    </div>

    <div>
      <label for="fuelTypeFilter">Fuel Type:</label>
      <input id="fuelTypeFilter" pInputText [(ngModel)]="fuelTypeFilter" placeholder="Filter by fuel type" />
    </div>

    <div>
      <label for="typeNameFilter">Type:</label>
      <input id="typeNameFilter" pInputText [(ngModel)]="typeNameFilter" placeholder="Filter by type" />
    </div>

    <div>
      <label for="plateNumberFilter">Plate Number:</label>
      <input id="plateNumberFilter" pInputText [(ngModel)]="plateNumberFilter" placeholder="Filter by plate number" />
    </div>

    <div>
      <label for="maxSpeedFilter">Max. Speed:</label>
      <p-slider [(ngModel)]="maxSpeedFilter" [min]="0" [max]="300" [step]="1" [range]="false"></p-slider>
      <span>{{ maxSpeedFilter }}</span>
    </div>

    <div>
      <label for="priceFilter">Price:</label>
      <p-slider [(ngModel)]="priceFilter" [min]="0" [max]="20000000" [step]="1000" [range]="false"></p-slider>
      <span>{{ priceFilter }}</span>
    </div>

    <div>
      <label for="minDate">Min Factory Date:</label>
      <input
        id="minDate"
        type="date"
        [ngModel]="formattedMinFactoryDate"
        (ngModelChange)="onMinDateChange($event)"
      />
    </div>


    <div>
      <label for="maxDate">Max Factory Date:</label>
      <input id="maxDate" type="date"  [ngModel]="formattedMaxFactoryDate" (ngModelChange)="onMaxDateChange($event)">
    </div>

    <p-button label="Filter" (onClick)="applyFilters()"></p-button>
    <div class="toggle-container">
      <table >
        <tr>
          <td class="toggle">Owners</td>
          <td class="toggle"><p-inputSwitch [(ngModel)]="showCars" (onChange)="applyOwnerFilters()"  /></td>
          <td class="toggle">Cars</td>
        </tr>
      </table>

    </div>

  </p-sidebar>
  <p-button (onClick)="sidebarVisible = true" *ngIf="showCars" icon="pi pi-bars" />
  <p-sidebar [(visible)]="sidebarVisible" *ngIf="!showCars">
    <p-button (onClick)="showDialog()" label="Add Owner" *ngIf="!showCars&&isAdmin"/>
    <h3>Filters</h3>

    <div>
      <label for="NameFilter">Name:</label>
      <input id="NameFilter" pInputText [(ngModel)]="NameFilter" placeholder="Filter by name" />
    </div>

    <div>
      <label for="EmailFilter">Email:</label>
      <input id="EmailFilter" pInputText [(ngModel)]="EmailFilter" placeholder="Filter by email" />
    </div>

    <div>
      <label for="ContactNumberFilter">Contact Number:</label>
      <input id="ContactNumberFilter" pInputText [(ngModel)]="ContactNumberFilter" placeholder="Filter by contact number" />
    </div>


    <div>
      <label for="PlateNumberFilterOwner">Plate Number:</label>
      <input id="PlateNumberFilterOwner" pInputText [(ngModel)]="PlateNumberFilterOwner" placeholder="Filter by plate number" />
    </div>

    <p-button label="Filter" (click)="applyOwnerFilters()"></p-button>
    <div class="toggle-container">
      <table >
        <tr>
          <td class="toggle">Owners</td>
          <td class="toggle"><p-inputSwitch [(ngModel)]="showCars" (onChange)="applyFilters()"/></td>
          <td class="toggle">Cars</td>
        </tr>
      </table>

    </div>
  </p-sidebar>
<p-button (onClick)="sidebarVisible = true" *ngIf="!showCars" icon="pi pi-bars" />

  <!-- Main content (form + table) -->
  <div class="main-content">

    <!-- The form can go here if needed -->

    <!-- Table for displaying cars -->
    <div *ngIf="showCars">
    <p-table [value]="filteredCars" [paginator]="true" [rows]="20" [sortField]="'brandName'">

      <ng-template pTemplate="header">
        <tr>
          <th>Brand</th>
          <th>Color</th>
          <th>Fuel Type</th>
          <th>Max Speed</th>
          <th>Price</th>
          <th>Type</th>
          <th>Factory Date</th>
          <th>Plate Number</th>
          <th *ngIf="isAdmin">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-car>
        <tr *ngIf="editCar && editCar.properties.plateNumber === car.properties.plateNumber; else viewMode">
          <td><input [(ngModel)]="editCar.properties.carType.brandName" name="editBrandName" /></td>
          <td><input [(ngModel)]="editCar.properties.carType.color" name="editColor" /></td>
          <td><input [(ngModel)]="editCar.properties.carType.fuelType" name="editFuelType" /></td>
          <td><input [(ngModel)]="editCar.properties.carType.maxSpeed" type="number" name="editMaxSpeed" /></td>
          <td><input [(ngModel)]="editCar.properties.carType.price" type="number" name="editPrice" /></td>
          <td><input [(ngModel)]="editCar.properties.carType.typeName" name="editTypeName" /></td>
          <td><input [(ngModel)]="editCar.properties.factoryDate" type="date" name="editFactoryDate" /></td>
          <td><input [(ngModel)]="editCar.properties.plateNumber" name="editPlateNumber" readonly /></td>
          <td *ngIf="isAdmin">
            <p-button styleClass="ui-button-outlined" (click)="updateCar()" *ngIf="isAdmin">Save</p-button>
            <p-button severity="secondary" (click)="cancelEdit()">Cancel</p-button>
          </td>
        </tr>

        <ng-template #viewMode>
          <tr>
            <td>{{ car.properties.carType.brandName }}</td>
            <td>{{ car.properties.carType.color }}</td>
            <td>{{ car.properties.carType.fuelType }}</td>
            <td>{{ car.properties.carType.maxSpeed }}</td>
            <td>{{ car.properties.carType.price }}</td>
            <td>{{ car.properties.carType.typeName }}</td>
            <td>{{ car.properties.factoryDate }}</td>
            <td>{{ car.properties.plateNumber }}</td>
            <td>
              <p-button styleClass="ui-button-outlined" (click)="enableEdit(car)" *ngIf="isAdmin">Edit</p-button>
              <p-button severity="secondary" (click)="removeCar(car)" *ngIf="isAdmin">Remove</p-button>
            </td>
          </tr>
        </ng-template>
      </ng-template>

    </p-table>
  </div>
    <div *ngIf="!showCars" class="ndtable">
      <p-table [value]="filteredOwners" [paginator]="true" [rows]="20" >
        <ng-template pTemplate="header">
          <tr>
            <th>Name</th>
            <th>Contact Number</th>
            <th>Email</th>
            <th>Car Plate Number</th>
            <th *ngIf="isAdmin">Actions</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-owner>
          <!-- Edit mode for specific row -->
          <tr *ngIf="ownerToEdit && ownerToEdit.properties.plateNumber === owner.properties.plateNumber; else viewMode">
            <td><input [(ngModel)]="ownerToEdit.properties.name" name="editOwnerName" /></td>
            <td><input [(ngModel)]="ownerToEdit.properties.contactNumber" name="editOwnerContact" /></td>
            <td><input [(ngModel)]="ownerToEdit.properties.email" name="editOwnerEmail" /></td>
            <td><input [(ngModel)]="ownerToEdit.properties.plateNumber" name="editOwnerPlate" readonly /></td>
            <td *ngIf="isAdmin">
              <p-button (click)="updateOwner()">Update Owner</p-button>
              <p-button (click)="cancelEditOwner()">Cancel</p-button>
            </td>
          </tr>

          <!-- View mode for specific row -->
          <ng-template #viewMode>
            <tr>
              <td>{{ owner.properties.name }}</td>
              <td>{{ owner.properties.contactNumber }}</td>
              <td>{{ owner.properties.email }}</td>
              <td>{{ owner.properties.plateNumber }}</td>
              <td>
                <p-button (click)="editOwner(owner)" *ngIf="isAdmin">Edit</p-button>
                <p-button (click)="removeOwner(owner)" *ngIf="isAdmin">Remove</p-button>
              </td>
            </tr>
          </ng-template>
        </ng-template>
      </p-table>
    </div>

  </div>
</div>
</div>
